{% extends 'base.html' %}
{% block title %}Vendas{% endblock %}
{% block content %}
<div class="max-w-5xl mx-auto mt-8 space-y-6">
    <div class="flex justify-between items-center border-b border-gray-300 pb-3">
        <h1 class="text-3xl font-extrabold tracking-tight">Histórico de Vendas</h1>
        <a href="{% url 'sale_create' %}" class="btn border-none bg-red-800 text-white btn-sm hover:bg-red-900">+ Nova
            Venda</a>
    </div>

    <div class="space-y-4">
        {% for sale in sales %}
        <div class="card shadow-lg rounded-lg overflow-hidden">
            <div
                class="card-body flex justify-between px-[2.5em] {% if sale.status == 'open' %}bg-red-800 text-white{% elif sale.status == 'finalized' %}bg-green-700 text-white{% elif sale.status == 'cancelled' %}bg-gray-700 text-gray-200{% else %}bg-slate-200 text-gray-800{% endif %}">
                <div>
                    <h2 class="text-xl font-semibold">Venda #{{ sale.id }}</h2>
                    <div class="text-sm mb-2">
                        {% if sale.status == 'finalized' %}
                            <span>Encerrado em: {{ sale.updated_at|date:"d/m/Y H:i" }}</span>
                        {% else %}
                            <span>Criado em: {{ sale.created_at|date:"d/m/Y H:i" }}</span>
                        {% endif %}
                    </div>
                    <div class="block">
                        <span class="text-sm badge badge-soft badge-accent border-none text-white badge-lg {% if sale.status == 'open' %}bg-red-900 {% elif sale.status == 'finalized' %}bg-green-900 {% endif %}">
                            {%if sale.client %}
                            <label class="text-sm flex">Cliente: {{ sale.client.name }} </label>
                            {% else %}
                            <label class="text-white">Cliente: {{ sale.client_name }}</label>{% endif %}
                        </span>
                        <div class="text-sm my-[0.5em]">
                            <span
                                class="text-sm badge badge-soft badge-accent border-none text-white badge-lg {% if sale.status == 'open' %}bg-red-900 {% elif sale.status == 'finalized' %}bg-green-900 {% endif %}">Total:
                                R$ {{ sale.total }}</span>
                            <span
                                class="text-sm badge badge-soft badge-accent border-none text-white badge-lg {% if sale.status == 'open' %}bg-red-900 {% elif sale.status == 'finalized' %}bg-green-900 {% endif %}">Pago:
                                R$ {{ sale.paid_amount }} </span>
                            {% if sale.balance < 0 %}
                            <span
                                class="badge badge-soft badge-accent bg-yellow-600 border-none text-white badge-lg text-sm">Crédito:
                                R$ {{ sale.credit_amount|floatformat:2 }}</span>
                            {% else %}
                            <span
                                class="text-sm badge badge-soft badge-accent border-none text-white badge-lg {% if sale.status == 'open' %}bg-red-900 {% elif sale.status == 'finalized' %}bg-green-900 {% endif %}">Saldo:
                                R$ {{ sale.balance|floatformat:2 }}</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div>
                    <a href="{% url 'sale_detail' sale.id %}" class="btn btn-sm"> <span
                            class="material-symbols-outlined">
                            open_in_new
                        </span>Abrir venda</a>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="alert alert-warning bg-neutral-200 border-none">Nenhuma venda registrada.</div>
        {% endfor %}
    </div>
</div>
{% endblock %}